---
title: "Univariate plotting & summary metrics of spatial model output"
author: "Ben Williams"
date: "October 26, 2015"
output: html_document
---
This is the initial examination using Ole's model output file from 2015-10-29.

```{r load, message=FALSE, echo=FALSE}
library(extrafont)
#font_import() only do this one time - it takes a while
loadfonts(device="win")
windowsFonts(Times=windowsFont("TT Times New Roman"))

library(ggplot2)
theme_set(theme_bw(base_size=12,base_family='Times New Roman')+ 
  theme(panel.grid.major = element_blank(),
  panel.grid.minor = element_blank()))

library(maps)
library(mapdata)
library(mapproj)
```

```{r, cache=FALSE, echo=FALSE}
meanCPUE <- read.csv("All_sp_index_meanCPUEByArea.csv") # load data
meanCPUE <- subset(meanCPUE,area!='Total') #remove total column
meanCPUE <- droplevels(meanCPUE) 
meanCPUE$area <- as.numeric(levels(meanCPUE$area))[meanCPUE$area]#use numeric/factor conventions
meanCPUE$Area <- factor(meanCPUE$area)
meanCPUE$vari <- meanCPUE$SD.totalDensity^2 #calculate variance

discrete_areas <- read.csv("./goaTrawl/Output Data/goa_discrete_areas_for_comparison(50_to_150m).csv")
#head(discrete_areas)
```

```{r map, cache=FALSE, echo=FALSE}
ak<-map_data('worldHires','USA:Alaska')
akmap<-ggplot()+geom_polygon(data=ak,aes(long,lat,group=group),fill=8,color="black")+
    theme(panel.background=element_rect(fill='aliceblue'))+
    xlab(expression(paste(Longitude^o,~'W')))+
    ylab(expression(paste(Latitude^o,~'N')))+
    coord_map(xlim = c(-160, -143),ylim = c(54, 61))
```

Map of area locations

```{r, echo=FALSE, cache=FALSE}
discrete_areas$area <- discrete_areas$Area
discrete_areas$Area <- factor(discrete_areas$area)
akmap+geom_point(data=discrete_areas,aes(LONGITUDE,LATITUDE,color=Area))
```


Examine variance 

```{r variance,echo=FALSE}
a <- aggregate(vari~area+year,data=meanCPUE,FUN=sum)
b <- aggregate(Mean.totalDensity~area+year,data=meanCPUE,FUN=sum)
c <- merge(a, b, by=c("area", "year"))
c$se <- sqrt(c$vari)
c$uci <- c$se*2 + c$Mean.totalDensity
c$lci <- c$Mean.totalDensity - c$se*2
c$Area <- factor(c$area)


ggplot(c, aes(year, Mean.totalDensity, group=Area, color=Area))+geom_line()+
  geom_ribbon(aes(ymin=lci, ymax=uci, fill=Area), alpha=.2)
```

All species combined

```{r, echo=FALSE}
ggplot(c, aes(year, Mean.totalDensity,color=Area))+stat_summary(fun.y=sum, geom="line")
```

Area 8 jumps out as higher than the other areas


Examine all species minus Walleye Pollock, Arrowtooth Flounder and Pacific Halibut

```{r, echo=FALSE}
#subset by area
smean <- subset(meanCPUE, Species!="Theragrachalcogramma" & Species!="Atheresthesstomias"& Species!="Hippoglossoideselassodon")
smean <- droplevels(smean)

ggplot(smean, aes(year, Mean.totalDensity,color=Area))+stat_summary(fun.y=sum, geom="line")
```

Walleye Pollock, Arrowtooth Flounder and Pacific Halibut

```{r, echo=FALSE}
#pull out species "groups"
polarrhal <- subset(meanCPUE, Species=="Theragrachalcogramma" | Species== "Atheresthesstomias" | Species!="Hippoglossoideselassodon" )
polarrhal <- droplevels(polarrhal)
#ggplot(polarrhal, aes(year, Mean.totalDensity,color=Species, group=Species))+geom_point()+geom_line()+facet_wrap(~area, ncol=1, scales="free")

ggplot(polarrhal, aes(year, Mean.totalDensity,color=Area))+stat_summary(fun.y=sum, geom="line")
```


Cod and Spiny Dogfish

```{r, echo=FALSE}
#pull out species "groups"
codsha <- subset(meanCPUE, Species=="Gadusmacrocephalus"| Species=="Squalusacanthias")

#ggplot(codsha, aes(year, Mean.totalDensity,color=Species, group=Species))+geom_point()+geom_line()+facet_wrap(~area, ncol=1, scales="free")

ggplot(codsha, aes(year, Mean.totalDensity,color=Area))+stat_summary(fun.y=sum, geom="line")
```


Capelin, Herring, and Eulachon

```{r, echo=FALSE}
#pull out species "groups"
capherreu <- subset(meanCPUE,Species== "Mallotusvillosus"|Species== "Clupeapallasi" | Species=="Thaleichthyspacificus")

#ggplot(capherreu, aes(year, Mean.totalDensity,color=Species, group=Species))+geom_point()+geom_line()+facet_wrap(~area, ncol=1, scales="free")

ggplot(capherreu, aes(year, Mean.totalDensity,color=Area))+stat_summary(fun.y=sum, geom="line")
```


Rock Sole, Yellowfin Sole, Bigmouth Sculpin, Ling Cod

```{r, echo=FALSE}
#pull out species "groups"
rocyelbig <- subset(meanCPUE, Species=="Lepidopsettasp"|Species== "Limandaaspera"|Species== "Hemitripterusbolini" | Species == "Ophiodonelongatus" |Species =="Dasycottussetiger" | Species=="Hemilepidotus Jordani")

#ggplot(rocyelbig, aes(year, Mean.totalDensity,color=Species, group=Species))+geom_point()+geom_line()+facet_wrap(~area, ncol=1, scales="free")

ggplot(rocyelbig, aes(year, Mean.totalDensity,color=Area))+stat_summary(fun.y=sum, geom="line")
```

Bairdi Crab

```{r, echo=FALSE}
#pull out species "groups"
bai <- subset(meanCPUE, Species=="Chionoecetesbairdi")

#ggplot(bai, aes(year, Mean.totalDensity,color=Species, group=Species))+geom_point()+geom_line()+facet_wrap(~area, ncol=1, scales="free")

ggplot(bai, aes(year, Mean.totalDensity,color=Area))+stat_summary(fun.y=sum, geom="line")
```
