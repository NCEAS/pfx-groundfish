############################################
### PFX-Groundfish
### Calculate Rao's Q for Taxonomic Data
### Rachael Blake, March 2016
############################################

library(ade4) ; library(abind)

# This sources the Rao's Q calculation with Jost correction from the paper
# Journal of Vegetation Science 21: 992–1000, 2010
# DOI: 10.1111/j.1654-1103.2010.01195.x
source("Appendix_Theseus/Appendix2/Rao.r")

# Use the species by CPUE per Area data generated by Ole's models.
head(SPCPUEArea)

# must make a 3D species by site array...x=species, y=area, z=year
b_arr <- array(NA, dim=c(11,57,30))  # makes an array of the correct size that's filled with NAs


# The function requires that a species x site matrix is identified with "sample="
RaoJost<-Rao(sample=spxsite, dfunc=NULL, dphyl=NULL, weight=F, Jost=T, structure=NULL)

# The Rao function returns a list of lists of objects. 
names(RaoJost)

# For taxonomical diversity (identified as ‘TD’) different results are available.
names(RaoJost$TD)

# To extract the Alpha Simpson diversity for each plot:
RaoJost$TD$Alpha

# The ‘Pairwise_sample’ list includes all values of α, β and γ for each pairs of sample.
names(RaoJost$TD$Pairwise_sample)

# look at pairwise sample beta diversity 
RaoJost$TD$Pairwise_sample$Beta_prop 



 
 