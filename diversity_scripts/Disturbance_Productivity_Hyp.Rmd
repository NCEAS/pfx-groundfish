---
title: "Disturbance_Productivity_Hypothesis"
author: "Rachael E. Blake"
date: "January 31, 2017"
output:
  pdf_document: default
  html_document: default
---

```{r, include=FALSE, echo=FALSE, results='hide'}
# Load packages
library(vegan)
library(mvnormtest)
library(plyr)
library(tidyverse)
library(forcats)
library(gridExtra)
library(ggplot2)
library(psych)

```

```{r, include=FALSE, echo=FALSE, results='hide'}
# source the diversity metrics csv file
div_met <- read.csv("../diversity-data/DiversityMetrics.Shallow.Bootstrapped.Final.csv")
#head(div_met)

```

```{r, include=FALSE, echo=FALSE, results='hide'}
# source the fishing pressure calculation script
source("../diversity_scripts/Fishing_Pressure_calc.r")

# want the catch_sum dataframe from here
#head(catch_sum)

```

```{r, echo=FALSE, results='hide'}
# source the chlorophyll a calculation script

```

# Fishing Pressure effects on Diversity Metrics
```{r, echo=FALSE, results='hide'}
# clean the data
catch_sum2 <- catch_sum %>%
              dplyr::rename(Catch_area = final.OLE,
                            Year = year) %>%
              select(Catch_area, Year, met_ton_km2) %>%
              arrange(Catch_area, Year)

div_met2 <- div_met %>%
            rename(Year = YEAR) %>%
            mutate(Catch_area = plyr::mapvalues(AREA, c("1","2","3","4","5","6","7","8","9","10"), 
                                                c("Prince William Sound","Prince William Sound",
                                                  "Prince William Sound","Cook Inlet","Cook Inlet",
                                                  "Kodiak","Kodiak","Kodiak","Kodiak","Alaska Peninsula")))

# make one large dataframe
dist_df <- merge(div_met2, catch_sum2, all.x=T)

# filter for complete cases
dist_df <- dist_df %>% filter(complete.cases(.))

# average to catch area for each year...
dist_df_cat_ar <- dist_df %>%
                  select(-AREA, -Simp, -Invsimp) %>%
                  group_by(Catch_area, Year) %>%
                  summarize(Eff_Num_Sp_ca = mean(Eff_Num_Sp),
                            Sp_rich_ca = mean(Sp_rich),
                            Exp_B_Div_ca = mean(Exp_B_Div),
                            met_ton_km2_ca = mean(met_ton_km2)) %>%
                  ungroup() %>%
                  arrange(Catch_area, Year)
           
```

###with Linear fits
```{r, echo=FALSE, include=FALSE}
# visualizing some data
#pairs.panels(dist_df[,-c(1:3)],smooth=F,density=T,ellipses=F,lm=T,digits=3,scale=T)

lmfit1 <- lm(met_ton_km2_ca~Sp_rich_ca, data=dist_df_cat_ar)  # lm() fit 

div_plot1 <- ggplot(dist_df_cat_ar, aes(x=met_ton_km2_ca, y=Sp_rich_ca, color=Catch_area)) + geom_point() +
             stat_smooth(method="lm", col="blue") + ylab("Species Richness") + 
             xlab("Fishing Pressure (metric tonnes km-2)") + 
             theme(legend.position = "top") +
             labs(title=paste("Adj R^2 =",signif(summary(lmfit1)$adj.r.squared, 5),
                              #"Intercept =",signif(lmfit1$coef[[1]],5 ),
                              #" Slope =",signif(lmfit1$coef[[2]], 5),
                              " p =",signif(summary(lmfit1)$coef[2,4], 5)))

anova(lmfit1) # anova table of above lm() fit

```

```{r, echo=FALSE, include=FALSE}
# visualizing some data

lmfit2 <- lm(met_ton_km2_ca~Eff_Num_Sp_ca, data=dist_df_cat_ar)  # lm() fit 

div_plot2 <- ggplot(dist_df_cat_ar, aes(x=met_ton_km2_ca, y=Eff_Num_Sp_ca, color=Catch_area)) + geom_point() +
             stat_smooth(method="lm", col="blue") + ylab("Effective # of Species") +
             xlab("Fishing Pressure (metric tonnes km-2)") + 
             theme(legend.position = "top") +
             labs(title=paste("Adj R^2 =",signif(summary(lmfit2)$adj.r.squared, 5),
                              #"Intercept =",signif(lmfit2$coef[[1]],5 ),
                              #" Slope =",signif(lmfit2$coef[[2]], 5),
                              " p =",signif(summary(lmfit2)$coef[2,4], 5)))

anova(lmfit2) # anova table of above lm() fit

```

```{r, echo=FALSE, include=FALSE}
# visualizing some data

lmfit3 <- lm(met_ton_km2_ca~Exp_B_Div_ca, data=dist_df_cat_ar)  # lm() fit 

div_plot3 <- ggplot(dist_df_cat_ar, aes(x=met_ton_km2_ca, y=Exp_B_Div_ca, color=Catch_area)) + geom_point() +
             stat_smooth(method="lm", col="blue") + ylab("Beta Diversity ") + 
             xlab("Fishing Pressure (metric tonnes km-2)") + 
             theme(legend.position = "top") +
             labs(title=paste("Adj R^2 =", signif(summary(lmfit3)$adj.r.squared, 5),
                              #"Intercept =",signif(lmfit3$coef[[1]],5 ),
                              #" Slope =",signif(lmfit3$coef[[2]], 5),
                              " p =",signif(summary(lmfit3)$coef[2,4], 5)))

anova(lmfit3) # anova table of above lm() fit

```

```{r, echo=FALSE, fig.height=9, fig.width=10}
# arranging above plots
grid.arrange(div_plot1, div_plot2, div_plot3, ncol=2, nrow=2)

```

###with Loess fits
```{r, echo=FALSE, fig.height=9, fig.width=10}
div_plotA <- ggplot(dist_df_cat_ar, aes(x=met_ton_km2_ca, y=Sp_rich_ca, color=Catch_area)) + geom_point() +
             stat_smooth(method="loess", col="blue") + ylab("Species Richness") + 
             theme(legend.position = "top") +
             xlab("Fishing Pressure (metric tonnes km-2)")

div_plotB <- ggplot(dist_df_cat_ar, aes(x=met_ton_km2_ca, y=Eff_Num_Sp_ca, color=Catch_area)) + geom_point() +
             stat_smooth(method="loess", col="blue") + ylab("Effective # of Species") +
             theme(legend.position = "top") +
             xlab("Fishing Pressure (metric tonnes km-2)") 

div_plotC <- ggplot(dist_df_cat_ar, aes(x=met_ton_km2_ca, y=Exp_B_Div_ca, color=Catch_area)) + geom_point() +
             stat_smooth(method="loess", col="blue") + ylab("Beta Diversity ") + 
             theme(legend.position = "top") +
             xlab("Fishing Pressure (metric tonnes km-2)")

grid.arrange(div_plotA, div_plotB, div_plotC, ncol=2, nrow=2)

```


